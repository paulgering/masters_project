## Loading packages

```{r loadlib, echo = TRUE, results = 'hide', warning = FALSE, message = FALSE}
library(here) #locate files based on current working directory
library(MASS) #Fit negative binomial regression
library(pwr) #Conduct power analysis
library(MuMIn) #Calculate the Akaike Information Criterion (AIC) for each model
library(AER) #conduct an overdispersion test on Poisson Models
```

# Load the data 

```{r}
df <- read.csv(here("data"))
```

## Fitting the models to a Poisson Distribution
### Model 0 - Null Model 

```{r}
M0 = glm(18m_cdi_vocab_count ~ condition, family = Poisson, data=df)
```

### Model 1 - Count of infant 'intentional Prelinguistic Communicative Acts

```{r}
M1 = glm(18m_cdi_vocab_count ~ condition + 12m_pca_count ,family=poisson,data=df)

summary(M1)
```

### Model 2 - Count of infant 'intentional Prelinguistic Communicative Acts that elicited a response of any kind

```{r}
M2 = glm(18m_cdi_vocab_count ~ condition + 12m_responses_pca_only_count ,family=poisson,data=df)

summary(M2)
```

### Model 3 - Count of infant 'intentional Prelinguistic Communicative Acts that elicited a content-light response

```{r}
M3 = glm(18m_cdi_vocab_count ~ condition + 12m_cl_pca_only_count ,family=poisson,data=df)

summary(M3)
```

### Model 4 - Count of infant 'intentional Prelinguistic Communicative Acts that elicited a semantically contingent response

```{r}
M4 = glm(18m_cdi_vocab_count ~ condition + 12m_sc_pca_only_count ,family=poisson,data=df)


summary(M4)
```

### Model 5 - A count of (infant 'intentional Prelinguistic Communicative Acts + non-gaze-coordinated vocalisations) that elicited a response of any kind

```{r}
M5 = glm(18m_cdi_vocab_count ~ condition + 12m_responses_all_count ,family=poisson,data=df)

summary(M5)
```

### Model 6 - A count of (infant 'intentional Prelinguistic Communicative Acts + non-gaze-coordinated vocalisations) that elicited a content-light response

```{r}
M6 = glm(18m_cdi_vocab_count ~ condition + 12m_cl_all_count ,family=poisson,data=df)

summary(M6)
```

### Model 7 - A count of (infant 'intentional Prelinguistic Communicative Acts + non-gaze-coordinated vocalisations) that elicited a semantically contingent response

```{r}
M7 = glm(18m_cdi_vocab_count ~ condition + 12m_sc_all_count ,family=poisson,data=df)

summary(M7)
```

## Testing for overdispersion
Determine whether overdispersion has occurred for any of the built models using the overdisp_fun. The code used to write the function were taken from the [GLMM FAGQ](https://bbolker.github.io/mixedmodels-misc/glmmFAQ.html#overdispersion) by Ben Bolker and colleagues.

```{r}
# Testing for overdispersion in each of the models
dispersiontest(M1)
dispersiontest(M2)
dispersiontest(M3)
dispersiontest(M4)
dispersiontest(M5)
dispersiontest(M6)
dispersiontest(M7)
```

## Negative binomial analyses 
If any of these tests detect overdispersion, a negative binomial regression will be fitted instead.

```{r}
M1_nb = glm.nb(18m_cdi_vocab_count ~ condition + 12m_pca_count ,family=poisson,data=df)

summary(M1)
```

```{r}
M2_nb = glm.nb(18m_cdi_vocab_count ~ condition + 12m_responses_pca_only_count ,family=poisson,data=df)

summary(M2)
```

```{r}
M3_nb = glm.nb(18m_cdi_vocab_count ~ condition + 12m_cl_pca_only_count ,family=poisson,data=df)

summary(M3)
```

```{r}
M4_nb = glm.nb(18m_cdi_vocab_count ~ condition + 12m_sc_pca_only_count ,family=poisson,data=df)


summary(M4)
```

```{r}
M5_nb = glm.nb(18m_cdi_vocab_count ~ condition + 12m_responses_all_count ,family=poisson,data=df)

summary(M5)
```

```{r}
M6_nb = glm.nb(18m_cdi_vocab_count ~ condition + 12m_cl_all_count ,family=poisson,data=df)

summary(M6)
```

```{r}
M7_nb = glm.nb(18m_cdi_vocab_count ~ condition + 12m_sc_all_count ,family=poisson,data=df)

summary(M7)
```

## Testing Prediction 1: Infants who produce more PCA's will have a alrger vocabulary size at 18 months 

```{r}
anova(M1, M0)
```

## Testing Prediction 2: The combination of PCA + response will be a better predictor of vocabulary size than all PCAs including those not met with a response 

```{r}
model.sel(M2, M1)
```

## Testing Prediction 3: Infant PCAs that elicit a semantically contingent response will be the strongest predictor of vocabulary over and above other sequences

```{r}
model.sel(M4, M1, M2, M3, M5, M6, M7)
```

## Testing Prediction 4: Infant ‘intentional’ PCAs and non-gaze-coordinated vocalisations that, regardless of infant intent, elicit a semantically contingent response (measure 2c) will predict vocabulary better than those that elicit other responses (measure 2a, any response, or measure 2b, a content light response)

```{r}
model.sel(M7, M5, M6)
```

## Exploratory analysis 1: Assessing the predictive value of content light responses relative to other kinds of responses

```{r}
model.sel(M3, M2, M4)
```

```{r}
model.sel(M6, M5, M7)
```

## Exploratory analysis 2: Assessing the predictive value of Infant intentional PCAs relative to a larger set of behaviours including non-gaze coordinated vocalisations

```{r}
model.sel(M2, M5)
```

```{r}
model.sel(M3, M6)
```

```{r}
model.sel(M4, M7)
```

# Post-Hoc Power Analysis

```{r}
# Define the baseline rate
baselinerate = 

# Define the observed rate
observed_rate = 

# Perform a post hoc power analysis using a Poisson test
pwr.ppois(lambda1 = baselinerate, lambda2 = observed_rate, alpha = 0.05, power = NULL)

```

